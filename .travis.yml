sudo: required
dist: xenial
before_cache:
- find $HOME/.sbt -name "*.lock" | xargs rm
- find $HOME/.ivy2 -name "ivydata-*.properties" | xargs rm
cache:
  directories:
  - "$HOME/.ivy2/cache"
  - "$HOME/.sbt"
language: scala
scala:
- 2.12.9
jdk:
- openjdk8
before_install:
  - curl -fsSL https://github.com/Z3Prover/z3/releases/download/z3-4.8.7/z3-4.8.7-x64-ubuntu-16.04.zip -o z3-4.8.7-x64-ubuntu-16.04.zip; unzip -j z3-4.8.7-x64-ubuntu-16.04.zip -d z3_downloaded; export PATH=$PATH:$(pwd)/z3_downloaded; z3 --version;
stages:
- test
- formatting
- name: release
  if: tag =~ ^v
- name: snapshot
  if: "(NOT tag IS present) AND (type = push)"
jobs:
  include:
  - stage: test
    script: sbt scalafmtCheck coverage test && sbt coverageReport coverageAggregate
      coveralls
  - stage: formatting
    script: sbt scalafmtCheck
  - stage: release
    script: openssl aes-256-cbc -K $encrypted_98cf3af00429_key -iv $encrypted_98cf3af00429_iv
      -in ci/secring.asc.enc -out ci/secring.asc -d && gpg --import ci/secring.asc
      && sbt -jvm-opts .travis.jvmopts publishSigned sonatypeBundleRelease
  - stage: snapshot
    script: sbt publish
